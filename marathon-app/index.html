<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b0f14" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <title>Sub-3 Marathon Plan</title>
  <style>
    :root { --bg:#0b0f14; --card:#111826; --muted:#93a4b8; --text:#e7eef8; --accent:#5eead4; --accent2:#60a5fa; --warn:#fbbf24; --danger:#fb7185; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#05070a,#0b0f14);color:var(--text)}
    header{padding:16px;border-bottom:1px solid rgba(255,255,255,.08);position:sticky;top:0;background:rgba(11,15,20,.92);backdrop-filter: blur(10px);z-index:10}
    h1{margin:0;font-size:16px;font-weight:800}
    .sub{margin:6px 0 0;color:var(--muted);font-size:12px;line-height:1.35}
    .wrap{display:grid;grid-template-columns: 1.15fr .85fr;gap:12px;max-width:1180px;margin:0 auto;padding:12px}
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr; } }
    .card{background:linear-gradient(180deg,rgba(17,24,38,.95),rgba(17,24,38,.82));border:1px solid rgba(255,255,255,.08);border-radius:14px;box-shadow:0 14px 32px rgba(0,0,0,.35);overflow:hidden}
    .toolbar{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid rgba(255,255,255,.08);gap:8px;flex-wrap:wrap}
    .btn{background:rgba(255,255,255,.06);color:var(--text);border:1px solid rgba(255,255,255,.10);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700;font-size:12px}
    .btn:hover{border-color:rgba(94,234,212,.45)}
    .pill{font-size:12px;color:var(--muted);padding:6px 10px;border:1px solid rgba(255,255,255,.10);border-radius:999px;background:rgba(255,255,255,.04)}
    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:12px}
    .dow{color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:.08em;text-align:center;padding:6px 0}
    .day{min-height:92px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);padding:8px;cursor:pointer;display:flex;flex-direction:column;gap:6px}
    .day:hover{border-color:rgba(96,165,250,.55)}
    .dnum{font-weight:900;font-size:12px}
    .tagrow{display:flex;flex-wrap:wrap;gap:6px;margin-top:auto}
    .tag{font-size:10px;padding:3px 7px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);color:var(--muted)}
    .tag.hard{color:#0b0f14;background:rgba(94,234,212,.95)}
    .tag.mp{color:#0b0f14;background:rgba(96,165,250,.95)}
    .tag.long{color:#0b0f14;background:rgba(251,191,36,.95)}
    .tag.rest{color:#0b0f14;background:rgba(147,164,184,.85)}
    .tag.race{color:#0b0f14;background:rgba(251,113,133,.95)}
    .selected{outline:2px solid rgba(94,234,212,.65);border-color:rgba(94,234,212,.65)}
    .panel{padding:12px}
    .panel h2{margin:0;font-size:14px}
    .meta{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 12px}
    .section{border-top:1px solid rgba(255,255,255,.08);padding-top:10px;margin-top:10px}
    .k{color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px}
    .v{white-space:pre-wrap;line-height:1.45;font-size:13px}
    .note{color:var(--muted);font-size:12px;line-height:1.4}
    .small{font-size:12px;color:var(--muted)}
    .footer{padding:10px 12px;border-top:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    @media (max-width: 520px){ .day{min-height:78px} .tagrow{display:none} }
    #installBar{display:none;position:fixed;left:12px;right:12px;bottom:12px;background:rgba(17,24,38,.96);border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:10px 12px;box-shadow:0 18px 40px rgba(0,0,0,.45);z-index:999}
    #installBar .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  </style>
</head>
<body>
<header>
  <h1>Sub-3 Marathon Plan • Jan 5 → Apr 26, 2026</h1>
  <div class="sub">Tap any day to see workout, supplements, nutrition, and recovery.</div>
</header>

<div class="wrap">
  <div class="card">
    <div class="toolbar">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <button class="btn" id="prev">◀ Prev</button>
        <button class="btn" id="jump">Jump to Start</button>
        <button class="btn" id="next">Next ▶</button>
        <span class="pill" id="monthLabel"></span>
      </div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <span class="pill">Race: <strong>Apr 26, 2026</strong></span>
        <span class="pill">MP: <strong>6:50–6:55</strong></span>
      </div>
    </div>
    <div class="grid" id="dowRow"></div>
    <div class="grid" id="calGrid"></div>
    <div class="footer">
      <div class="small">Base → Build → Peak → Taper → Race</div>
      <div class="small">Hard/long days: carbs + sleep = better mood/drive.</div>
    </div>
  </div>

  <div class="card">
    <div class="panel">
      <h2 id="detailTitle">Select a day</h2>
      <div class="meta" id="detailMeta"></div>

      <div class="section"><div class="k">Workout</div><div class="v" id="detailWorkout">Tap a date.</div></div>
      <div class="section"><div class="k">Supplements</div><div class="v" id="detailSupps"></div></div>
      <div class="section"><div class="k">Nutrition targets</div><div class="v" id="detailFood"></div></div>
      <div class="section">
        <div class="k">Recovery</div><div class="v" id="detailRecovery"></div>
        <div class="note" style="margin-top:8px">You can’t literally “turn cortisol into dopamine,” but you can reduce stress spikes and support dopamine rhythm with sunlight, sleep, post-run carbs, breathwork, and consistent training.</div>
      </div>
    </div>
  </div>
</div>

<div id="installBar">
  <div class="row">
    <div>
      <div style="font-weight:900;font-size:13px;">Install this as an app</div>
      <div class="note">Tap “Install” to add to your home screen.</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center;">
      <button class="btn" id="installBtn">Install</button>
      <button class="btn" id="dismissBtn">Not now</button>
    </div>
  </div>
</div>

<script>
if ('serviceWorker' in navigator) window.addEventListener('load', ()=>navigator.serviceWorker.register('./sw.js').catch(()=>{}));

let deferredPrompt=null;
const installBar=document.getElementById('installBar');
window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;installBar.style.display='block';});
document.getElementById('installBtn').addEventListener('click', async ()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBar.style.display='none';});
document.getElementById('dismissBtn').addEventListener('click', ()=>installBar.style.display='none');

const pad2=n=>String(n).padStart(2,'0');
const fmt=d=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
const fmtNice=d=>d.toLocaleDateString(undefined,{weekday:'long',year:'numeric',month:'long',day:'numeric'});
const diffDays=(a,b)=>Math.floor((a-b)/(24*3600*1000));

const PLAN_START=new Date(2026,0,5);   // Jan 5
const RACE_DAY=new Date(2026,3,26);    // Apr 26

const DOW=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
const DOW_LONG=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
const phaseForWeek=w=> w<=0?"Pre-Plan": w<=4?"Base": w<=10?"Build": w<=14?"Peak": w<=16?"Taper":"Post";
const weekNumber=date=>Math.floor(diffDays(date,PLAN_START)/7)+1;

const longRunMiles={Base:[12,13,14,15],Build:[16,17,18,19,20,20],Peak:[18,20,22,20],Taper:[14,8]};

const tueWorkouts={
  Base:()=>`Speed: Warmup 1–1.5 mi + drills\n6×400m @ 6:15–6:30/mi effort\nRest: 90s jog\nCooldown 1 mi\nTotal: ~5–6 mi`,
  Build:()=>`Intervals: Warmup 1–2 mi\n5×1K @ 6:20–6:30/mi effort\nRest: 2:00 jog\nCooldown 1–2 mi\nTotal: ~7–9 mi`,
  Peak:()=>`VO₂: Warmup 2 mi\n6×1 mile @ ~6:25–6:35/mi\nRest: 2:30 jog\nCooldown 1–2 mi\nTotal: ~10–12 mi`,
  Taper:(w)=> (w===15)
    ?`Sharpen: Warmup 1.5–2 mi\n4×1K @ 6:20–6:30/mi\nRest: 2:00 jog\nCooldown 1–1.5 mi\nTotal: ~6–8 mi`
    :`Race-week pop: Warmup 1–1.5 mi\n3×800m @ ~6:15–6:25/mi\nRest: 2:00 jog\nCooldown 1 mi\nTotal: ~4.5–6 mi`
};
const thuWorkouts={
  Base:(w)=>`Tempo: Warmup 1 mi\n${(w<=2)?'3 mi':'4–5 mi'} @ 7:15–7:30/mi\nCooldown 1 mi\nTotal: ~5–7 mi`,
  Build:(w)=>`Marathon Pace Block: Warmup 2 mi\n${(w<=6)?'4–5 mi':'6–8 mi'} @ MP (6:50–6:55)\nCooldown 1 mi\nTotal: ~7–11 mi`,
  Peak:(w)=>`Marathon Pace Sustained: Warmup 2 mi\n${(w<=12)?'8 mi':'10 mi'} @ MP (6:50–6:55)\nCooldown 1–2 mi\nTotal: ~11–14 mi`,
  Taper:(w)=> (w===15)
    ?`MP reminder: Warmup 2 mi\n6 mi @ MP\nCooldown 1 mi\nTotal: ~9 mi`
    :`Race-week tune: Warmup 1.5 mi\n3 mi @ MP\nCooldown 1 mi\nTotal: ~5.5 mi`
};

const wedMiles=phase=> phase==="Base"?"6–7 mi easy (8:15–9:15) + mobility"
  :phase==="Build"?"7–9 mi easy (8:15–9:15) + 6×20s strides (optional)"
  :phase==="Peak"?"8–10 mi easy (8:15–9:15) + mobility"
  :"6–7 mi easy (keep it relaxed)";
const friPlan=phase=> phase==="Taper"?"3–4 mi easy + LIGHT strength (2 sets each) + core"
  :"3–5 mi easy + Strength (20–30 min): squat/goblet, RDL, pull, push, core";
const sunPlan=(phase,w)=> (phase==="Taper"&&w===16)?"3 mi very easy + 4×20s strides (shakeout) OR rest":"5–7 mi easy + 6×20s strides + early bedtime";

function supplementsFor(dayType){
  let s=`AM (with breakfast):\n• Vitamin D3: 2000–4000 IU\n• Omega-3: 2–3g EPA/DHA\n• Rhodiola: 200–400 mg (optional)\n• L-Tyrosine: 500–1000 mg (optional)\n\nDaily:\n• Creatine: 5g\n\nPM (60–90 min before bed):\n• Magnesium glycinate: 300–400 mg\n• Zinc: 15–25 mg`;
  if(dayType==="long"||dayType==="race") s+=`\n\nRun fueling:\n• Sodium 500–1000 mg/hr\n• Carbs 30–60g/hr (build tolerance)`;
  if(dayType==="hard") s+=`\n\nOptional:\n• Caffeine 50–150 mg pre-run (only if sleep stays good)`;
  return s;
}
function nutritionFor(dayType){
  const c=`Protein: 190–210g/day\nHydration: 80–120 oz/day + electrolytes`;
  if(dayType==="rest") return `${c}\nCalories: 2400–2600\nCarbs: 200–280g\nFocus: recovery + sleep`;
  if(dayType==="easy") return `${c}\nCalories: 2600–2800\nCarbs: 250–350g\nPost-run: carbs + protein within 90 min`;
  if(dayType==="hard") return `${c}\nCalories: 2800–3200\nCarbs: 330–450g\nPost-run: 80–120g carbs + 30–50g protein`;
  if(dayType==="long") return `${c}\nCalories: 3000–3600+\nCarbs: 400–550g\nDuring: 30–60g carbs/hr + sodium`;
  if(dayType==="race") return `${c}\nCarb-load Thu–Sat; race AM carbs + sodium; during 60–90g carbs/hr (if tolerated)`;
  return c;
}
function recoveryFor(dayType){
  const d=`Daily (15 min):\n• Foam roll 5 min\n• Mobility 8–10 min\n• Breathing 2–5 min\nSleep: 7.5–9 hours`;
  const drive=`\n\nDrive routine:\n• 10 min morning sunlight + short walk\n• 1 small “win” task early\n• Social connection after hard work`;
  if(dayType==="hard"||dayType==="long") return `${d}\n\nPost-run: walk 10 min + carbs + fluids ASAP\nEvening: earlier bedtime${drive}`;
  return `${d}${drive}`;
}

function getDayPlan(date){
  const w=weekNumber(date);
  const phase=phaseForWeek(w);
  const dow=date.getDay();
  const isRaceWeek=(phase==="Taper"&&w===16);

  if(fmt(date)===fmt(RACE_DAY)){
    return {title:"RACE DAY — MARATHON",week:w,phase:"Race",type:"race",tags:["RACE"],
      workout:`Marathon — Goal: sub-3:00\nTarget: 6:50–6:55/mi\n\nWarmup 10–15 min + 4×20s strides\nPacing: 1–3 @ 6:58–7:05, 4–20 @ 6:50–6:55, 21–26.2 compete\nFuel: gel every 25–30 min + sodium 500–1000 mg/hr`,
      supps:supplementsFor("race"),food:nutritionFor("race"),recovery:recoveryFor("race")};
  }
  if(w<=0){
    return {title:"Prep Day",week:w,phase,type:"rest",tags:["PREP"],
      workout:`Plan starts Jan 5, 2026.\nToday: walk 20–40 min OR 2–4 mi easy + mobility 10 min.`,
      supps:supplementsFor("rest"),food:nutritionFor("rest"),recovery:recoveryFor("rest")};
  }

  if(dow===1) return {title:"Recovery Day",week:w,phase,type:"rest",tags:["RECOVERY"],
    workout:isRaceWeek?`Recovery + loosen:\n• Walk 20–30 min\n• Mobility 10–15 min\n• Optional 15–20 min easy jog`
                    :`Recovery:\n• Walk 20–30 min\n• Mobility 10–15 min\n• Optional 2–4 mi very easy`,
    supps:supplementsFor("rest"),food:nutritionFor("rest"),recovery:recoveryFor("rest")};

  if(dow===2){
    const key=(["Base","Build","Peak","Taper"].includes(phase))?phase:"Base";
    return {title:"Speed / VO₂ Day",week:w,phase,type:"hard",tags:["HARD"],
      workout:tueWorkouts[key](w),supps:supplementsFor("hard"),food:nutritionFor("hard"),recovery:recoveryFor("hard")};
  }

  if(dow===3) return {title:"Aerobic Easy Day",week:w,phase,type:"easy",tags:["EASY"],
    workout:wedMiles(phase),supps:supplementsFor("easy"),food:nutritionFor("easy"),recovery:recoveryFor("easy")};

  if(dow===4){
    const key=(["Base","Build","Peak","Taper"].includes(phase))?phase:"Base";
    return {title:key==="Base"?"Tempo Day":"Marathon Pace Day",week:w,phase,type:"hard",tags:["MP"],
      workout:thuWorkouts[key](w),supps:supplementsFor("hard"),food:nutritionFor("hard"),recovery:recoveryFor("hard")};
  }

  if(dow===5) return {title:"Strength + Short Easy",week:w,phase,type:"easy",tags:["EASY"],
    workout:friPlan(phase),supps:supplementsFor("easy"),food:nutritionFor("easy"),recovery:recoveryFor("easy")};

  if(dow===6){
    if(phase==="Base"){
      const lr=longRunMiles.Base[Math.min(w-1,3)];
      return {title:"Long Run",week:w,phase,type:"long",tags:["LONG"],
        workout:`Long Run: ${lr} mi @ 8:30–9:00\nIf >14 mi, practice fueling: 30–45g carbs/hr + sodium`,
        supps:supplementsFor("long"),food:nutritionFor("long"),recovery:recoveryFor("long")};
    }
    if(phase==="Build"){
      const lr=longRunMiles.Build[Math.min(Math.max(w-5,0),5)];
      const finish=(lr>=18)?"Last 3–5 mi @ 7:00–7:10":"Optional last 2 mi steady";
      return {title:"Long Run (Build)",week:w,phase,type:"long",tags:["LONG"],
        workout:`Long Run: ${lr} mi\nFinish: ${finish}\nFuel: 30–60g carbs/hr + sodium`,
        supps:supplementsFor("long"),food:nutritionFor("long"),recovery:recoveryFor("long")};
    }
    if(phase==="Peak"){
      const lr=longRunMiles.Peak[Math.min(Math.max(w-11,0),3)];
      const mpFinish=(lr>=20)?"Finish last 6–8 mi @ MP (6:50–6:55)":"Finish last 4–6 mi strong";
      return {title:"Long Run (Peak)",week:w,phase,type:"long",tags:["LONG","MP"],
        workout:`Long Run: ${lr} mi\n${mpFinish}\nFuel: practice race fueling (work toward 60g/hr+)`,
        supps:supplementsFor("long"),food:nutritionFor("long"),recovery:recoveryFor("long")};
    }
    if(phase==="Taper"){
      const lr=longRunMiles.Taper[Math.min(Math.max(w-15,0),1)];
      const note=(w===15)?"Include 4 mi @ MP inside the run.":"Keep it easy; bank freshness.";
      return {title:"Long Run (Taper)",week:w,phase,type:"long",tags:["LONG"],
        workout:`Long Run: ${lr} mi easy\n${note}`,supps:supplementsFor("long"),food:nutritionFor("long"),recovery:recoveryFor("long")};
    }
  }

  if(dow===0) return {title:"Easy + Strides",week:w,phase,type:"easy",tags:["EASY"],
    workout:sunPlan(phase,w),supps:supplementsFor("easy"),food:nutritionFor("easy"),recovery:recoveryFor("easy")};

  return {title:"Easy Day",week:w,phase,type:"easy",tags:["EASY"],workout:"Easy run 4–6 mi + mobility",
    supps:supplementsFor("easy"),food:nutritionFor("easy"),recovery:recoveryFor("easy")};
}

const dowRow=document.getElementById('dowRow');
const calGrid=document.getElementById('calGrid');
const monthLabel=document.getElementById('monthLabel');
const detailTitle=document.getElementById('detailTitle');
const detailMeta=document.getElementById('detailMeta');
const detailWorkout=document.getElementById('detailWorkout');
const detailSupps=document.getElementById('detailSupps');
const detailFood=document.getElementById('detailFood');
const detailRecovery=document.getElementById('detailRecovery');

function renderDow(){
  dowRow.innerHTML="";
  DOW.forEach(d=>{const el=document.createElement('div');el.className="dow";el.textContent=d;dowRow.appendChild(el);});
}

let viewDate=new Date(2026,0,1);
let selectedKey=null;

function dayTags(plan){
  const tags=[];
  if(plan.type==="race") tags.push({t:"RACE",cls:"race"});
  else if(plan.type==="long") tags.push({t:"LONG",cls:"long"});
  else if(plan.tags.includes("MP")) tags.push({t:"MP",cls:"mp"});
  else if(plan.tags.includes("HARD")) tags.push({t:"HARD",cls:"hard"});
  else if(plan.type==="rest") tags.push({t:"REC",cls:"rest"});
  else tags.push({t:"EASY",cls:""});
  if(plan.phase && !["Post","Pre-Plan"].includes(plan.phase)) tags.push({t:plan.phase,cls:""});
  return tags;
}

function setDetails(date){
  const p=getDayPlan(date);
  detailTitle.textContent=`${fmtNice(date)} — ${p.title}`;
  detailMeta.innerHTML="";
  [
    {label:"Phase",val:p.phase},
    {label:"Week",val:(p.week<=0?"—":p.week)},
    {label:"Day",val:DOW_LONG[date.getDay()]},
    {label:"Type",val:p.type.toUpperCase()}
  ].forEach(x=>{const sp=document.createElement('span');sp.className="pill";sp.innerHTML=`${x.label}: <strong>${x.val}</strong>`;detailMeta.appendChild(sp);});
  detailWorkout.textContent=p.workout;
  detailSupps.textContent=p.supps;
  detailFood.textContent=p.food;
  detailRecovery.textContent=p.recovery;
}

function renderMonth(date){
  const y=date.getFullYear(), m=date.getMonth();
  monthLabel.textContent=date.toLocaleDateString(undefined,{month:'long',year:'numeric'});
  calGrid.innerHTML="";
  const first=new Date(y,m,1);
  const last=new Date(y,m+1,0);
  const startDow=first.getDay();
  const daysInMonth=last.getDate();

  for(let i=0;i<startDow;i++){
    const blank=document.createElement('div');
    blank.className="day";
    blank.style.visibility="hidden";
    calGrid.appendChild(blank);
  }

  for(let d=1; d<=daysInMonth; d++){
    const cur=new Date(y,m,d);
    const key=fmt(cur);
    const plan=getDayPlan(cur);

    const cell=document.createElement('div');
    cell.className="day";
    if(key===selectedKey) cell.classList.add("selected");

    const inWindow=(cur>=PLAN_START && cur<=RACE_DAY);
    if(!inWindow && key!==fmt(RACE_DAY)) cell.style.opacity=0.65;

    const dnum=document.createElement('div'); dnum.className="dnum"; dnum.textContent=d; cell.appendChild(dnum);
    const title=document.createElement('div'); title.className="small"; title.style.color="var(--muted)"; title.textContent=plan.title; cell.appendChild(title);

    const tagrow=document.createElement('div'); tagrow.className="tagrow";
    dayTags(plan).slice(0,3).forEach(tag=>{const t=document.createElement('span'); t.className="tag "+(tag.cls||""); t.textContent=tag.t; tagrow.appendChild(t);});
    cell.appendChild(tagrow);

    if(key===fmt(RACE_DAY)){
      cell.style.borderColor="rgba(251,113,133,.7)";
      cell.style.boxShadow="0 0 0 2px rgba(251,113,133,.25) inset";
    }

    cell.addEventListener('click', ()=>{
      selectedKey=key;
      renderMonth(viewDate);
      setDetails(cur);
    });

    calGrid.appendChild(cell);
  }
}

document.getElementById('prev').addEventListener('click', ()=>{viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth()-1,1);renderMonth(viewDate);});
document.getElementById('next').addEventListener('click', ()=>{viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth()+1,1);renderMonth(viewDate);});
document.getElementById('jump').addEventListener('click', ()=>{
  viewDate=new Date(2026,0,1);
  selectedKey=fmt(PLAN_START);
  renderMonth(viewDate);
  setDetails(PLAN_START);
});

renderDow();
selectedKey=fmt(PLAN_START);
renderMonth(viewDate);
setDetails(PLAN_START);
</script>
</body>
</html>
